<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Gestão Escolar - IDEB/SAEB</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background-color: #f4f7f9; color: #333; }
        .dashboard-container { max-width: 1200px; margin: 20px auto; background-color: #fff; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .header { background-color: #007bff; color: white; padding: 20px; border-top-left-radius: 8px; border-top-right-radius: 8px; text-align: center; }
        .header h1 { margin: 0; font-size: 1.8em; }
        .tabs { display: flex; border-bottom: 2px solid #ddd; }
        .tab-button { background-color: #f8f9fa; border: none; padding: 15px 25px; cursor: pointer; font-size: 1em; transition: background-color 0.3s, color 0.3s; }
        .tab-button.active { background-color: #007bff; color: white; border-bottom: 2px solid #007bff; }
        .tab-content { padding: 30px; display: none; }
        .tab-content.active { display: block; }
        .card { background-color: #fff; padding: 20px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px; border-left: 5px solid #007bff; }
        .card h2 { color: #007bff; margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }
        .flex-container { display: flex; gap: 20px; flex-wrap: wrap; }
        .flex-item { flex: 1; min-width: 300px; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .metric-box { background-color: #e9ecef; padding: 15px; border-radius: 4px; text-align: center; }
        .metric-box .value { font-size: 2em; font-weight: bold; color: #007bff; }
        .metric-box .label { font-size: 0.9em; color: #555; }
        input[type="text"], input[type="number"], select { padding: 10px; margin-bottom: 10px; width: 100%; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
        button { background-color: #28a745; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #218838; }
        #flux-result { margin-top: 20px; padding: 15px; background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; border-radius: 4px; font-weight: bold; display: none; }
    </style>
</head>
<body>

<div class="dashboard-container">
    <div class="header">
        <h1>Painel de Gestão Escolar (IDEB/SAEB)</h1>
        <p>Análise de Indicadores Educacionais</p>
    </div>

    <div class="tabs">
        <button class="tab-button active" onclick="openTab(event, 'visaoGeral')">1. Visão Geral</button>
        <button class="tab-button" onclick="openTab(event, 'historicoIdeb')">2. Histórico IDEB</button>
        <button class="tab-button" onclick="openTab(event, 'analiseSaeb')">3. Análise SAEB</button>
        <button class="tab-button" onclick="openTab(event, 'comparativoEscolas')">4. Comparativo de Escolas</button>
        <button class="tab-button" onclick="openTab(event, 'calculadoraFluxo')">5. Calculadora de Fluxo</button>
    </div>

    <div id="visaoGeral" class="tab-content active">
        <div class="card">
            <h2>Indicadores Chave (Ensino Médio)</h2>
            <div class="metrics-grid">
                <div class="metric-box">
                    <div class="value">4.5</div>
                    <div class="label">IDEB Municipal (2021)</div>
                </div>
                <div class="metric-box">
                    <div class="value">90.2%</div>
                    <div class="label">Taxa de Aprovação (2023)</div>
                </div>
                <div class="metric-box">
                    <div class="value">10.5%</div>
                    <div class="label">Taxa de Abandono (2023)</div>
                </div>
                <div class="metric-box">
                    <div class="value">280.5</div>
                    <div class="label">Média SAEB LP (2023)</div>
                </div>
                <div class="metric-box">
                    <div class="value">295.1</div>
                    <div class="label">Média SAEB Mat (2023)</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Evolução do IDEB na Rede</h2>
            <canvas id="idebChart"></canvas>
        </div>
    </div>

    <div id="historicoIdeb" class="tab-content">
        <div class="card">
            <h2>Consulta de IDEB por Escola (2017-2019)</h2>
            <p>Os dados abaixo são extraídos do seu arquivo oficial do INEP.</p>
            <label for="schoolIdIdeb">Código INEP da Escola:</label>
            <input type="text" id="schoolIdIdeb" placeholder="Ex: 11024968" value="11024968">
            <button onclick="renderHistoricoIDEB()">Buscar Histórico IDEB</button>
        </div>

        <div class="card">
            <h2 id="idebSchoolName">Escola: Nome da Escola</h2>
            <div class="metrics-grid" id="idebMetrics">
                <div class="metric-box">
                    <div class="value" id="ideb2017">N/A</div>
                    <div class="label">IDEB 2017</div>
                </div>
                <div class="metric-box">
                    <div class="value" id="ideb2019">N/A</div>
                    <div class="label">IDEB 2019</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Gráfico de Evolução IDEB (2017-2019)</h2>
            <canvas id="schoolIdebChart"></canvas>
        </div>
    </div>

    <div id="analiseSaeb" class="tab-content">
        <div class="card">
            <h2>Desempenho no SAEB por Disciplina</h2>
            <canvas id="saebChart"></canvas>
        </div>
    </div>

    <div id="comparativoEscolas" class="tab-content">
        <div class="card">
            <h2>Comparação IDEB de Escolas</h2>
            <p>Selecione as escolas para comparar seus resultados.</p>
            <label for="school1">Escola 1 (Código INEP):</label>
            <input type="text" id="school1" placeholder="Ex: 11024968">

            <label for="school2">Escola 2 (Código INEP):</label>
            <input type="text" id="school2" placeholder="Ex: 11025638">

            <button onclick="compareSchools()">Comparar IDEB</button>
        </div>
        <div class="card">
            <h2>Gráfico Comparativo IDEB</h2>
            <canvas id="comparisonChart"></canvas>
        </div>
    </div>
    
    <div id="calculadoraFluxo" class="tab-content">
        <div class="card">
            <h2>Calculadora de Taxa de Fluxo (Aprovação e Abandono)</h2>
            <label for="aprovados">Número de Alunos Aprovados:</label>
            <input type="number" id="aprovados" value="850">

            <label for="reprovados">Número de Alunos Reprovados:</label>
            <input type="number" id="reprovados" value="50">

            <label for="abandonos">Número de Alunos com Abandono:</label>
            <input type="number" id="abandonos" value="100">

            <button onclick="calculateFlux()">Calcular Fluxo</button>

            <div id="flux-result"></div>
        </div>
    </div>

</div>

<script>
    // =========================================================================
    // DADOS REAIS EXTRAÍDOS DO SEU ARQUIVO "IDEB 2017, 2019 ARQUIVO OFICIAL INEP.xlsx..."
    // Chave: Código INEP da Escola (ID_ESCOLA)
    // =========================================================================
    const escolasIdeb2017_2019 = {
        // Amostra de Rondônia (RO) - Ensino Médio
        "11024968": {
            nome: "EEEMTI JUSCELINO KUBITSCHEK DE OLIVEIRA (RO)",
            2017: 5.0,
            2019: 5.5
        },
        "11025638": {
            nome: "EEEFM PADRE EZEQUIEL RAMIN (RO)",
            2017: 3.4,
            2019: 4.1
        },
        "11007885": {
            nome: "EEEMTI HEITOR VILLA LOBOS (RO)",
            2017: 4.9,
            2019: 4.8
        },
        "11007893": {
            nome: "EEEFM RICARDO CANTANHEDE (RO)",
            2017: 3.9,
            2019: 4.3
        },
        "11046740": {
            nome: "EEEMTI JOSINO BRITO (RO)",
            2017: null, // ND no arquivo
            2019: 4.9
        },
        // Amostra de outros estados (PA, MA, TO)
        "15161455": {
            nome: "EEEM SAO JOSE (PA)",
            2017: null,
            2019: null
        },
        "21131384": {
            nome: "CENTRO DE ENSINO DARCY VARGAS (MA)",
            2017: 3.4,
            2019: 3.9
        },
        "17037786": {
            nome: "ESC EST JOAQUIM FRANCISCO DE AZEVEDO (TO)",
            2017: 3.5,
            2019: 3.5
        }
    };

    let schoolIdebChartInstance = null;
    let comparisonChartInstance = null;
    let idebChartInstance = null;
    let saebChartInstance = null;

    // Função para alternar entre as abas
    function openTab(evt, tabName) {
        var i, tabcontent, tablinks;
        
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        
        tablinks = document.getElementsByClassName("tab-button");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " active";

        // Redesenhar gráficos ao mudar de aba
        if (tabName === 'visaoGeral') {
            renderIdebGeralChart();
        } else if (tabName === 'analiseSaeb') {
            renderSaebChart();
        }
    }

    // Função para renderizar o gráfico geral do IDEB (Aba 1)
    function renderIdebGeralChart() {
        if (idebChartInstance) idebChartInstance.destroy();
        const ctx = document.getElementById('idebChart').getContext('2d');
        const dados = [4.3, 4.5, 4.8]; // Valores mock para 2017, 2019, 2021 (Adapte com seus dados municipais)
        
        idebChartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['2017', '2019', '2021 (Projeção)'],
                datasets: [{
                    label: 'IDEB Municipal (Ensino Médio)',
                    data: dados,
                    borderColor: 'rgb(0, 123, 255)',
                    backgroundColor: 'rgba(0, 123, 255, 0.1)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true, max: 7.0 }
                }
            }
        });
    }

    // Função para buscar e renderizar o IDEB da Escola (Aba 2)
    function renderHistoricoIDEB() {
        const schoolId = document.getElementById('schoolIdIdeb').value.trim();
        const schoolData = escolasIdeb2017_2019[schoolId];
        
        document.getElementById('ideb2017').textContent = 'N/A';
        document.getElementById('ideb2019').textContent = 'N/A';
        document.getElementById('idebSchoolName').textContent = 'Escola: ID não encontrada';

        if (schoolData) {
            const ideb2017Value = schoolData[2017] !== null ? schoolData[2017].toFixed(1) : 'ND';
            const ideb2019Value = schoolData[2019] !== null ? schoolData[2019].toFixed(1) : 'ND';

            document.getElementById('idebSchoolName').textContent = `Escola: ${schoolData.nome}`;
            document.getElementById('ideb2017').textContent = ideb2017Value;
            document.getElementById('ideb2019').textContent = ideb2019Value;

            // Prepara os dados para o gráfico
            const dataForChart = [
                schoolData[2017],
                schoolData[2019]
            ].map(val => val === null ? NaN : val); // Chart.js lida com NaN (dados faltantes)

            if (schoolIdebChartInstance) schoolIdebChartInstance.destroy();
            const ctx = document.getElementById('schoolIdebChart').getContext('2d');

            schoolIdebChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2017', '2019'],
                    datasets: [{
                        label: `IDEB de ${schoolData.nome}`,
                        data: dataForChart,
                        backgroundColor: ['rgba(75, 192, 192, 0.6)', 'rgba(153, 102, 255, 0.6)'],
                        borderColor: ['rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true, max: 7.0 }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y === null || isNaN(context.parsed.y)) {
                                        label += 'ND (Não Divulgado)';
                                    } else {
                                        label += context.parsed.y.toFixed(1);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }
    }

    // Função para renderizar o gráfico SAEB (Aba 3)
    function renderSaebChart() {
        if (saebChartInstance) saebChartInstance.destroy();
        const ctx = document.getElementById('saebChart').getContext('2d');
        const mediaLP = [270.5, 275.0, 280.5]; // Mock
        const mediaMat = [285.0, 290.5, 295.1]; // Mock

        saebChartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['2019', '2021', '2023 (Projeção)'],
                datasets: [{
                    label: 'Média SAEB - Língua Portuguesa',
                    data: mediaLP,
                    borderColor: 'rgb(255, 99, 132)',
                    backgroundColor: 'rgba(255, 99, 132, 0.1)',
                    tension: 0.1
                },
                {
                    label: 'Média SAEB - Matemática',
                    data: mediaMat,
                    borderColor: 'rgb(54, 162, 235)',
                    backgroundColor: 'rgba(54, 162, 235, 0.1)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: false, min: 250, max: 350 }
                }
            }
        });
    }

    // Função para comparar escolas (Aba 4)
    function compareSchools() {
        const schoolId1 = document.getElementById('school1').value.trim();
        const schoolId2 = document.getElementById('school2').value.trim();
        const data1 = escolasIdeb2017_2019[schoolId1];
        const data2 = escolasIdeb2017_2019[schoolId2];

        if (!data1 || !data2) {
            alert("Certifique-se de que ambos os Códigos INEP são válidos na base de dados.");
            return;
        }

        const ideb2017_1 = data1[2017] !== null ? data1[2017] : NaN;
        const ideb2019_1 = data1[2019] !== null ? data1[2019] : NaN;
        const ideb2017_2 = data2[2017] !== null ? data2[2017] : NaN;
        const ideb2019_2 = data2[2019] !== null ? data2[2019] : NaN;

        if (comparisonChartInstance) comparisonChartInstance.destroy();
        const ctx = document.getElementById('comparisonChart').getContext('2d');

        comparisonChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['IDEB 2017', 'IDEB 2019'],
                datasets: [{
                    label: data1.nome,
                    data: [ideb2017_1, ideb2019_1],
                    backgroundColor: 'rgba(255, 159, 64, 0.6)',
                    borderColor: 'rgba(255, 159, 64, 1)',
                    borderWidth: 1
                }, {
                    label: data2.nome,
                    data: [ideb2017_2, ideb2019_2],
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true, max: 7.0 }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y === null || isNaN(context.parsed.y)) {
                                    label += 'ND (Não Divulgado)';
                                } else {
                                    label += context.parsed.y.toFixed(1);
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });
    }

    // Função para calcular o Fluxo (Aba 5)
    function calculateFlux() {
        const aprovados = parseFloat(document.getElementById('aprovados').value) || 0;
        const reprovados = parseFloat(document.getElementById('reprovados').value) || 0;
        const abandonos = parseFloat(document.getElementById('abandonos').value) || 0;
        const total = aprovados + reprovados + abandonos;
        const resultDiv = document.getElementById('flux-result');
        
        if (total === 0) {
            resultDiv.textContent = "Erro: O número total de alunos deve ser maior que zero.";
            resultDiv.style.backgroundColor = '#f8d7da';
            resultDiv.style.color = '#721c24';
            resultDiv.style.display = 'block';
            return;
        }

        const taxaAprovacao = (aprovados / total) * 100;
        const taxaReprovacao = (reprovados / total) * 100;
        const taxaAbandono = (abandonos / total) * 100;

        const resultadoHTML = `
            Total de Alunos: ${total}<br><br>
            Taxa de Aprovação (P): <strong>${taxaAprovacao.toFixed(2)}%</strong><br>
            Taxa de Reprovação: <strong>${taxaReprovacao.toFixed(2)}%</strong><br>
            Taxa de Abandono: <strong>${taxaAbandono.toFixed(2)}%</strong>
        `;

        resultDiv.innerHTML = resultadoHTML;
        resultDiv.style.backgroundColor = '#d4edda';
        resultDiv.style.color = '#155724';
        resultDiv.style.display = 'block';
    }

    // Inicialização - Redesenha os gráficos da aba ativa (Visão Geral)
    document.addEventListener('DOMContentLoaded', () => {
        renderIdebGeralChart();
        // Dispara a primeira busca na aba de Histórico IDEB para popular os campos
        renderHistoricoIDEB(); 
    });
</script>

</body>
</html>
