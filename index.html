<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Avalia√ß√µes Educacionais</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; background: #f7f7f7; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { background: #2d3e50; color: #fff; padding: 1em; border-radius: 8px; }
        .tabs { display: flex; background: white; border-radius: 10px; overflow: hidden; margin-bottom: 20px; }
        .tab { padding: 15px 25px; cursor: pointer; transition: all 0.3s; text-align: center; flex: 1; border-bottom: 3px solid transparent; }
        .tab.active { border-bottom: 3px solid #3498db; font-weight: 600; color: #3498db; }
        .tab-content { display: none; background: white; border-radius: 10px; padding: 25px; margin-bottom: 30px; }
        .tab-content.active { display: block; }
        #mapa { width: 100%; height: 350px; border: 1px solid #ccc; border-radius: 8px; margin-top: 20px; }
        .form-group { margin-bottom: 20px; }
        .info-escola { margin-bottom:20px; padding:15px; background:#f0f4f8; border-radius:5px; }
        table { border-collapse: collapse; margin-top: 15px; width: 100%; }
        th, td { border: 1px solid #999; padding: 5px 10px; }
        input, button { padding: 0.5em; font-size: 1em; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Sistema de Avalia√ß√µes Educacionais</h1>
            <p>Busque informa√ß√µes e visualize no mapa os indicadores das escolas.</p>
        </header>
        <div class="tabs">
            <div class="tab active" data-tab="tab1">Apresenta√ß√£o</div>
            <div class="tab" data-tab="tab2">Busca por INEP</div>
            <div class="tab" data-tab="tab3">Hist√≥rico SPAECE</div>
            <div class="tab" data-tab="tab4">Calculadora SPAECE</div>
            <div class="tab" data-tab="tab5">Calculadora Fluxo</div>
            <div class="tab" data-tab="tab6">Proje√ß√£o do IDEB</div>
            <div class="tab" data-tab="tab7">Promo√ß√£o Sem Titula√ß√£o</div>
        </div>

        <!-- Primeira aba: Apresenta√ß√£o -->
        <div class="tab-content active" id="tab1">
            <h2>Bem-vindo ao Sistema de Indicadores Educacionais</h2>
            <p>Este site permite consultar o hist√≥rico de indicadores das escolas brasileiras, visualizar dados no mapa e acessar ferramentas para an√°lise educacional.</p>
            <ul>
                <li>Consulte escolas pelo c√≥digo INEP</li>
                <li>Veja o hist√≥rico de IDEB, notas e localiza√ß√£o</li>
                <li>Ferramentas para an√°lise e proje√ß√£o de dados</li>
            </ul>
        </div>

        <!-- Segunda aba: Busca por INEP com mapa -->
        <div class="tab-content" id="tab2">
            <h2>Buscar escola pelo INEP</h2>
            <div class="form-group">
                <label for="codigoINEP">C√≥digo INEP da Escola (8 d√≠gitos):</label>
                <input type="text" id="codigoINEP" placeholder="Digite o INEP" maxlength="8">
                <button onclick="consultarHistoricoIDEB()">Buscar</button>
            </div>
            <div class="loading" id="loadingIDEB" style="display:none;">
                <p>üìä Carregando dados do IDEB...</p>
            </div>
            <div class="resultado" id="resultadoIDEB" style="display:none;">
                <div class="info-escola">
                    <h3>üè´ Informa√ß√µes da Escola</h3>
                    <p><strong>Nome:</strong> <span id="nomeEscola">-</span></p>
                    <p><strong>Endere√ßo:</strong> <span id="enderecoEscola">-</span></p>
                    <p><strong>Munic√≠pio:</strong> <span id="municipioEscola">-</span></p>
                    <p><strong>C√≥digo INEP:</strong> <span id="codigoEscola">-</span></p>
                </div>
                <h3>Hist√≥rico do IDEB</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Ano</th>
                                <th>IDEB</th>
                                <th>LP</th>
                                <th>MT</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaIDEB"></tbody>
                    </table>
                </div>
                <h3>Localiza√ß√£o da Escola</h3>
                <div id="mapa"></div>
            </div>
        </div>

        <!-- Terceira aba: mantenha o conte√∫do original -->
        <div class="tab-content" id="tab3">
            <h2>Hist√≥rico SPAECE</h2>
            <p>Funcionalidade em desenvolvimento.</p>
        </div>

        <!-- Quarta aba: mantenha o conte√∫do original -->
        <div class="tab-content" id="tab4">
            <h2>Calculadora SPAECE</h2>
            <p>Funcionalidade em desenvolvimento.</p>
        </div>

        <!-- Quinta aba: Calculadora de Fluxo Escolar (mantida como original) -->
        <div class="tab-content" id="tab5">
            <h2>Calculadora de Fluxo Escolar</h2>
            <div class="card">
                <h3>Calcular Fluxo Escolar</h3>
                <div class="form-group">
                    <label for="alunosInicio">N√∫mero de Alunos no In√≠cio do Ano:</label>
                    <input type="number" id="alunosInicio" min="1" value="100">
                </div>
                <div class="form-group">
                    <label for="alunosAprovados">N√∫mero de Alunos Aprovados:</label>
                    <input type="number" id="alunosAprovados" min="0" value="85">
                </div>
                <div class="form-group">
                    <label for="alunosReprovados">N√∫mero de Alunos Reprovados:</label>
                    <input type="number" id="alunosReprovados" min="0" value="10">
                </div>
                <div class="form-group">
                    <label for="alunosAbandonaram">N√∫mero de Alunos que Abandonaram:</label>
                    <input type="number" id="alunosAbandonaram" min="0" value="5">
                </div>
                <button onclick="calcularFluxo()">Calcular Fluxo</button>
            </div>
            <div class="resultado" id="resultadoFluxo" style="display: none;">
                <h3>üìä Resultados do Fluxo Escolar</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; text-align: center;">
                        <h4>Taxa de Aprova√ß√£o</h4>
                        <p style="font-size: 1.5em; font-weight: bold; color: #27ae60;" id="taxaAprovacao">0%</p>
                    </div>
                    <div style="background: #ffeaea; padding: 15px; border-radius: 8px; text-align: center;">
                        <h4>Taxa de Reprova√ß√£o</h4>
                        <p style="font-size: 1.5em; font-weight: bold; color: #d63031;" id="taxaReprovacao">0%</p>
                    </div>
                    <div style="background: #fff4e6; padding: 15px; border-radius: 8px; text-align: center;">
                        <h4>Taxa de Abandono</h4>
                        <p style="font-size: 1.5em; font-weight: bold; color: #e17055;" id="taxaAbandono">0%</p>
                    </div>
                </div>
                <h4>An√°lise do Fluxo:</h4>
                <div id="analiseFluxo" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;"></div>
            </div>
        </div>

        <!-- Sexta aba: mantenha o conte√∫do original -->
        <div class="tab-content" id="tab6">
            <h2>Proje√ß√£o do IDEB Futuro</h2>
            <p>Funcionalidade em desenvolvimento.</p>
        </div>

        <!-- S√©tima aba: Promo√ß√£o Sem Titula√ß√£o (mantida como original) -->
        <div class="tab-content" id="tab7">
            <h2>Promo√ß√£o Sem Titula√ß√£o</h2>
            <div class="card">
                <h3>Calcular Pontua√ß√£o para Promo√ß√£o</h3>
                <div class="form-group">
                    <label for="autoavaliacao">Autoavalia√ß√£o (2-20 pontos):</label>
                    <input type="number" id="autoavaliacao" min="2" max="20" value="12">
                </div>
                <div class="form-group">
                    <label for="avaliacaoChefe">Avalia√ß√£o do Chefe Imediato (2-20 pontos):</label>
                    <input type="number" id="avaliacaoChefe" min="2" max="20" value="15">
                </div>
                <div class="form-group">
                    <label for="tempoServico">Tempo de Servi√ßo (anos):</label>
                    <input type="number" id="tempoServico" min="0" max="30" value="8">
                </div>
                <div class="form-group">
                    <label for="cursos8_19">Cursos de 8-19 horas (1 ponto cada):</label>
                    <input type="number" id="cursos8_19" min="0" max="10" value="2">
                </div>
                <div class="form-group">
                    <label for="cursos20_80">Cursos de 20-80 horas (2 pontos cada):</label>
                    <input type="number" id="cursos20_80" min="0" max="5" value="1">
                </div>
                <div class="form-group">
                    <label for="cursos80Plus">Cursos acima de 80 horas (3 pontos cada):</label>
                    <input type="number" id="cursos80Plus" min="0" max="3" value="0">
                </div>
                <div class="form-group">
                    <label for="participacoes">Participa√ß√µes em Eventos (1 ponto cada):</label>
                    <input type="number" id="participacoes" min="0" max="10" value="3">
                </div>
                <div class="form-group">
                    <label for="apresentacoes">Apresenta√ß√µes de Trabalhos (2 pontos cada):</label>
                    <input type="number" id="apresentacoes" min="0" max="3" value="1">
                </div>
                <div class="form-group">
                    <label for="bancas">Participa√ß√£o em Bancas (2 pontos cada):</label>
                    <input type="number" id="bancas" min="0" max="3" value="0">
                </div>
                <div class="form-group">
                    <label for="elogios">Elogios/Reconhecimentos (2 pontos cada):</label>
                    <input type="number" id="elogios" min="0" max="3" value="1">
                </div>
                <div class="form-group">
                    <label for="posGraduacao">P√≥s-Gradua√ß√£o Conclu√≠da (4 pontos cada):</label>
                    <input type="number" id="posGraduacao" min="0" max="1" value="0">
                </div>
                <div class="form-group">
                    <label for="resultadoEscolar">Resultado Escolar (6-20 pontos):</label>
                    <input type="number" id="resultadoEscolar" min="6" max="20" value="14">
                </div>
                <button onclick="calcularPontuacaoPromocao()">Calcular Pontua√ß√£o Total</button>
            </div>
            <div class="resultado" id="resultadoPromocao" style="display: none;">
                <h3>üéØ Resultado da Pontua√ß√£o</h3>
                <div style="text-align: center; margin: 20px 0;">
                    <div style="font-size: 3em; font-weight: bold; color: #3498db;" id="pontuacaoTotal">0</div>
                    <p>pontos de 100 poss√≠veis</p>
                </div>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h4>Detalhamento da Pontua√ß√£o:</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 5px 0;">‚Ä¢ Fatores Subjetivos: <strong id="detSubjetivos">0 pontos</strong></li>
                        <li style="padding: 5px 0;">‚Ä¢ Experi√™ncia Profissional: <strong id="detExperiencia">0 pontos</strong></li>
                        <li style="padding: 5px 0;">‚Ä¢ Capacita√ß√£o 1: <strong id="detCap1">0 pontos</strong></li>
                        <li style="padding: 5px 0;">‚Ä¢ Capacita√ß√£o 2: <strong id="detCap2">0 pontos</strong></li>
                        <li style="padding: 5px 0;">‚Ä¢ Capacita√ß√£o 3: <strong id="detCap3">0 pontos</strong></li>
                        <li style="padding: 5px 0;">‚Ä¢ Resultado Escolar: <strong id="detResultado">0 pontos</strong></li>
                    </ul>
                </div>
                <div id="statusPromocao" style="text-align: center; padding: 15px; border-radius: 8px; margin: 20px 0;"></div>
                <h4>üìã Recomenda√ß√µes para Melhoria:</h4>
                <div id="recomendacoes" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;"></div>
            </div>
        </div>
    </div>

    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDsCBlh5vPsyqBUZXxWPlJTamAdbqvujWg"></script>
    <script>
        // Abas
        document.querySelectorAll('.tab').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                this.classList.add('active');
                document.getElementById(this.dataset.tab).classList.add('active');
                if (this.dataset.tab === "tab2") setTimeout(() => initMap(), 200);
            });
        });

        // Busca INEP + Mapa
        let escolas = {};
        let mapa;
        let marcador;

        fetch('escolas.json')
            .then(res => res.json())
            .then(data => { escolas = data; });

        function initMap(lat = -15.7797, lng = -47.9297) {
            mapa = new google.maps.Map(document.getElementById("mapa"), {
                center: {lat: lat, lng: lng},
                zoom: 5
            });
        }

        function consultarHistoricoIDEB() {
            const inep = document.getElementById('codigoINEP').value.trim();
            const escola = escolas[inep];
            const resultado = document.getElementById('resultadoIDEB');
            const loading = document.getElementById('loadingIDEB');
            if (marcador) { marcador.setMap(null); }
            if (!escola) {
                resultado.style.display = 'none';
                alert('Escola n√£o encontrada. Verifique o INEP.');
                return;
            }
            loading.style.display = 'block';
            setTimeout(() => {
                loading.style.display = 'none';
                resultado.style.display = 'block';
                document.getElementById('nomeEscola').textContent = escola.nome || '-';
                document.getElementById('enderecoEscola').textContent = escola.endereco || '-';
                document.getElementById('municipioEscola').textContent = escola.municipio || '-';
                document.getElementById('codigoEscola').textContent = inep;
                // Preenche tabela
                const tbody = document.getElementById('tabelaIDEB');
                tbody.innerHTML = '';
                (escola.historico || []).forEach(h => {
                    tbody.innerHTML += `<tr><td>${h.ano}</td><td>${h.ideb ?? '-'}</td><td>${h.nota_lp ?? '-'}</td><td>${h.nota_mt ?? '-'}</td></tr>`;
                });
                // Mapa
                if (escola.latitude && escola.longitude) {
                    initMap(escola.latitude, escola.longitude);
                    marcador = new google.maps.Marker({
                        position: {lat: escola.latitude, lng: escola.longitude},
                        map: mapa,
                        title: escola.nome || inep
                    });
                } else {
                    initMap();
                }
            }, 500);
        }

        // Calculadora de Fluxo Escolar (aba 5)
        function calcularFluxo() {
            const alunosInicio = parseInt(document.getElementById('alunosInicio').value) || 0;
            const alunosAprovados = parseInt(document.getElementById('alunosAprovados').value) || 0;
            const alunosReprovados = parseInt(document.getElementById('alunosReprovados').value) || 0;
            const alunosAbandonaram = parseInt(document.getElementById('alunosAbandonaram').value) || 0;

            if (alunosInicio === 0 || (alunosAprovados + alunosReprovados + alunosAbandonaram) > alunosInicio) {
                alert('Verifique os n√∫meros. O total de Aprovados + Reprovados + Abandonados n√£o pode ser maior que o n√∫mero inicial de alunos.');
                return;
            }

            const taxaAprovacao = (alunosAprovados / alunosInicio) * 100;
            const taxaReprovacao = (alunosReprovados / alunosInicio) * 100;
            const taxaAbandono = (alunosAbandonaram / alunosInicio) * 100;

            document.getElementById('taxaAprovacao').textContent = taxaAprovacao.toFixed(1) + '%';
            document.getElementById('taxaReprovacao').textContent = taxaReprovacao.toFixed(1) + '%';
            document.getElementById('taxaAbandono').textContent = taxaAbandono.toFixed(1) + '%';

            let analise = `Com ${alunosInicio} alunos, a escola obteve: <br><br>`;
            if (taxaAprovacao >= 90) {
                analise += `<strong>Taxa de Aprova√ß√£o (${taxaAprovacao.toFixed(1)}%):</strong> Excelente! O fluxo escolar est√° muito saud√°vel.`;
            } else if (taxaAprovacao >= 80) {
                analise += `<strong>Taxa de Aprova√ß√£o (${taxaAprovacao.toFixed(1)}%):</strong> Boa. Mantenha os esfor√ßos para reduzir as perdas.`;
            } else {
                analise += `<strong>Taxa de Aprova√ß√£o (${taxaAprovacao.toFixed(1)}%):</strong> Necessita aten√ß√£o. Uma baixa aprova√ß√£o pode impactar negativamente o IDEB.`;
            }
            analise += '<br><br>';
            if (taxaReprovacao + taxaAbandono >= 10) {
                analise += `<strong>Taxas de Perda:</strong> As taxas de Reprova√ß√£o (${taxaReprovacao.toFixed(1)}%) e Abandono (${taxaAbandono.toFixed(1)}%) somam ${(taxaReprovacao + taxaAbandono).toFixed(1)}%. Isso indica que ${alunosReprovados + alunosAbandonaram} alunos n√£o seguiram o fluxo esperado. Foco total em estrat√©gias de recupera√ß√£o e perman√™ncia.`;
            } else {
                analise += `<strong>Taxas de Perda:</strong> As perdas por Reprova√ß√£o e Abandono est√£o abaixo de 10%, o que √© positivo e contribui para um bom Coeficiente de Rendimento no IDEB.`;
            }
            document.getElementById('analiseFluxo').innerHTML = analise;
            document.getElementById('resultadoFluxo').style.display = 'block';
        }

        // Calculadora Promo√ß√£o Sem Titula√ß√£o (aba 7)
        function calcularPontuacaoPromocao() {
            const autoavaliacao = parseInt(document.getElementById('autoavaliacao').value) || 0;
            const avaliacaoChefe = parseInt(document.getElementById('avaliacaoChefe').value) || 0;
            const tempoServico = parseInt(document.getElementById('tempoServico').value) || 0;
            const cursos8_19 = parseInt(document.getElementById('cursos8_19').value) || 0;
            const cursos20_80 = parseInt(document.getElementById('cursos20_80').value) || 0;
            const cursos80Plus = parseInt(document.getElementById('cursos80Plus').value) || 0;
            const participacoes = parseInt(document.getElementById('participacoes').value) || 0;
            const apresentacoes = parseInt(document.getElementById('apresentacoes').value) || 0;
            const bancas = parseInt(document.getElementById('bancas').value) || 0;
            const elogios = parseInt(document.getElementById('elogios').value) || 0;
            const posGraduacao = parseInt(document.getElementById('posGraduacao').value) || 0;
            const resultadoEscolar = parseInt(document.getElementById('resultadoEscolar').value) || 0;

            const subjetivos = autoavaliacao + avaliacaoChefe;
            const experiencia = Math.min(tempoServico, 25);
            const cap1 = Math.min(cursos8_19, 10) * 1 + Math.min(cursos20_80, 5) * 2 + Math.min(cursos80Plus, 3) * 3 + Math.min(participacoes, 10) * 1;
            const cap2 = Math.min(apresentacoes, 3) * 2 + Math.min(bancas, 3) * 2 + Math.min(elogios, 3) * 2;
            const cap3 = Math.min(posGraduacao, 1) * 4;
            const resultado = Math.max(6, Math.min(resultadoEscolar, 20));

            const total = subjetivos + experiencia + cap1 + cap2 + cap3 + resultado;

            document.getElementById('pontuacaoTotal').textContent = total;
            document.getElementById('detSubjetivos').textContent = subjetivos + " pontos";
            document.getElementById('detExperiencia').textContent = experiencia + " pontos";
            document.getElementById('detCap1').textContent = cap1 + " pontos";
            document.getElementById('detCap2').textContent = cap2 + " pontos";
            document.getElementById('detCap3').textContent = cap3 + " pontos";
            document.getElementById('detResultado').textContent = resultado + " pontos";
            document.getElementById('resultadoPromocao').style.display = 'block';

            let status = "";
            if (total >= 80) {
                status = "<span style='color:green;font-weight:bold;'>Apto para promo√ß√£o!</span>";
            } else if (total >= 60) {
                status = "<span style='color:orange;font-weight:bold;'>Aten√ß√£o: Pontua√ß√£o razo√°vel, busque melhorar alguns crit√©rios.</span>";
            } else {
                status = "<span style='color:red;font-weight:bold;'>Pontua√ß√£o baixa. Reforce sua forma√ß√£o e resultados.</span>";
            }
            document.getElementById('statusPromocao').innerHTML = status;

            let recomendacoes = "";
            if (subjetivos < 30) recomendacoes += "‚Ä¢ Invista em autoavalia√ß√£o e di√°logo com seu chefe.<br>";
            if (experiencia < 10) recomendacoes += "‚Ä¢ Mais tempo de servi√ßo aumenta sua pontua√ß√£o.<br>";
            if (cap1 < 8) recomendacoes += "‚Ä¢ Fa√ßa mais cursos e participe de eventos.<br>";
            if (cap2 < 4) recomendacoes += "‚Ä¢ Apresente trabalhos e participe de bancas.<br>";
            if (cap3 < 4) recomendacoes += "‚Ä¢ Conclua uma p√≥s-gradua√ß√£o.<br>";
            if (resultado < 15) recomendacoes += "‚Ä¢ Melhore os resultados escolares.<br>";
            document.getElementById('recomendacoes').innerHTML = recomendacoes || "Parab√©ns! Continue evoluindo.";
        }
    </script>
</body>
</html>
